# 问题确认与回答

## 问题 1：合规率的计算逻辑

**你的理解**："购买后绿电的消费是否满足RPS要求"

**实际情况**：✅ 基本正确，但需澄清：
- **绿电消费量**（`re_consumed`）= 总消电 × 绿电占比
- **RPS要求量** = 总消电 × RPS目标比例
- 合规判断：`绿电消费 >= RPS要求`
- **注意**：购买 CAQ/TGC 配额 **不会改变绿电消费量**（这是物理量），只会改变财务余额
- 所以合规率是基于**物理绿电**判断，与是否购买配额无关

**代码位置**：`envs/vectorized_env.py` 第 88-100 行（compliance_reward）和第 668-672 行（_collect_info）

---

## 问题 2：现在的奖励函数

### 主要奖励函数：`profit_reward`（权重 1.0）

**公式**：
```
利润 = 售电收入 - 发电成本 - CAQ交易支出 - TGC交易支出 - 违规罚款 + 盈余奖励
     = 消电量×零售电价 - (火电消电×火电价 + 绿电消电×绿电价)
       - CAQ成交×价格 - TGC成交×价格
       - max(0,-余额)×罚款单价 + max(0,余额)×奖励单价

最终奖励 = 利润 / 平均需求量 × 1e-6（scale因子）
```

### 辅助奖励函数：`compliance_reward`（权重可配置）

**公式**：
```
compliance = 1 if 绿电消费 >= RPS要求 else 0
```

**当前配置**（`RewardConfig`）：
- components: `["profit"]`（只用主奖励）
- weights: `[1.0]`
- normalize: `True`
- scale: `1e-6`

---

## 问题 3、4 的修改计划

### 修改项目：
1. ✅ 移除 train_gpu.py 中的 TensorBoard 代码
2. ✅ 新增绘图脚本 `plot_reward_from_checkpoint.py`（读取第 N 轮的模型，绘制 11 期的奖励曲线）
3. ✅ 修改 train_gpu.py 支持快速调试模式（100 episodes）

---

## 汇总表

| 序号 | 问题 | 答案 |
|------|------|------|
| 1 | 合规率基于购买后的绿电吗？ | ✅ 是，但注意购买配额不改变绿电消费量 |
| 2 | 奖励函数是什么？ | `profit / avg_demand × 1e-6`，基于市场利润 |
| 3 | 移除 TensorBoard | 正在修改... |
| 4 | 训练 100 episodes | 正在修改... |

